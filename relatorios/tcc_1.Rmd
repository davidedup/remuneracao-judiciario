---
title: "TCC: Remuneração do sistema judiciário brasileiro"

output:
  prettydoc::html_pretty:
    theme: cayman
    css: '/home/david/Área de Trabalho/tcc/stylesheets/style.css'
    highlight: github
    df_print: paged
---


```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
library(kableExtra)
library(ggplot2)
theme_set(theme_bw())
library(genderBR)
options(scipen=999)
library(magrittr)
library(stringr)
```

# Dados do Sistema de Justiça Brasileiro

A Lei Federal 12.527/2011, ou mais comumente conhecida como Lei de Acesso à Informação (LAI), diz que é “obrigatória a divulgação em sítios oficiais da rede mundial de computadores (internet)” dos dados de gastos públicos. Por isso, órgãos que fazem parte do sistema de justiça periodicamente disponibilizam em seus sites informações detalhada sobre seus gastos, que são disponíveis para todos. Uma parte importante desses gastos são as remunerações dos trabalhadores e trabalhadoras desses órgãos.
Os agentes públicos do sistema de justiça brasileiro recebem outras verbas, além de seus salários, para exercerem seus cargos. Dentre elas encontramos auxílio moradia, despesas com saúde, auxílio transporte, gratificações, diárias, entre outros benefícios. Dados detalhados sobre essas remunerações devem ser disponibilizados nos sites de cada órgão. 
Devido a grande quantidade de auxílios é importante ter um controle sobre esses gastos e verificar a moralidade e legitimidades do recebimento desses benefícios.

## Remunerção x salário

As remunerações¹ incluem valores que vão além do salário². Os conhecidos auxílios, benefícios ou indenizações, são gastos eventuais que podem constituir as remunerações. Auxílios como alimentação, pré escolar, saúde, natalidade, moradia e ajuda de custo, são exemplos de benefícios que podem ser recebidas por funcionários dos tribunais e ministérios públicos do Brasil

* ¹Remuneração: é a soma do salário mais outras vantagens (indenizações e auxílios).

* ²Salário: valor recebido de acordo com a prestação de serviços, em decorrência do contrato de trabalho. Valor fixo mensal.

## Descrição dos dados

Os dados utilizados nessa análise foram conseguidos através da iniciativa do DadosJusBR, que teve início no Hackfest (2018) e até hoje desenvolve trabalhos de libertação dos dados de remuneração do sistema de justiça brasileiro.  

Abaixo temos uma descrição das principais variáveis que estão disponíveis nos dados:

* subsidio = Salário recebido pelo magistrado
* direitos_pessoais = Total recebido através de direitos pessoais       
* indenizações = Total recebido através de indenizações
* direitos_eventuais = Total recebido através de direitos eventuais
* total_descontos = Somatório de todos os descontos aplicados à remuneração do Magistrado
* rendimento_liquido = Subsídios + Adicionais - Descontos
* tottal_de_rendimentos = Total de rendimentos do Magistrado"

Ainda é possível encontrar todas os valores pormenorizados de cada benefício/indenização. Para ver o restante das colunas [aqui](https://github.com/davidedup/remuneracao-judiciario/blob/master/dados/2018-1-datapackage/data.csv).

# Como são as remunerações dos magistrados
Abaixo temos resumos e visualizações sobre os dados de remunerção dos anos de 2016 a 2019. 

### 2016
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_2016 = read_csv(here("dados/2016-12-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc")
dados_2016 <- dados_2016 %>% mutate(mes = 12) %>% mutate(ano = 2016)
dados_2016 <- dados_2016 %>% filter(direitos_eventuais >= 0, imposto_de_renda >= 0, total_de_descontos >= 0, diarias >= 0, substituicao >= 0, total_de_direitos_eventuais >= 0) %>% filter(subsidio >= 1045)

dados_2016$genero <- get_gender(dados_2016$nome)

summary(dados_2016)
```


```{r}
dados_2016 %>% 
  ggplot(aes(x=" ", y=subsidio, color=" ")) +
  geom_boxplot() +
  theme_minimal() +
  scale_y_log10(labels = scales::comma, breaks=c(5000, 10000, 15000, 20000,25000, 35000, 50000, 65000)) +
  theme(legend.position = "none")
  
```


```{r}
dados_2016  %>% 
  ggplot(aes(x=subsidio)) +
  geom_histogram(bins = 5) + 
  theme_minimal() +
  scale_x_log10(labels = scales::comma, breaks=c(5000, 10000, 15000, 20000,25000, 35000, 50000, 65000)) +
  labs(x="", y = "Salário", title = "Distribuição dos salários recebido pelos magistrados em dezembro de 2016") 
```


```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
#Distribuição dos salários
dados_2016 %>%
  ggplot(aes(x=" ", y=subsidio, color=" ")) +
  geom_violin() +
  theme_minimal() + 
  theme(legend.position = "none") +
  scale_y_log10(labels = scales::comma, breaks=c(5000, 10000, 15000, 20000,25000, 35000, 50000, 65000)) +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.7,position=position_jitter(0.2)) +
  stat_summary(fun.y = mean, colour = "purple", geom = "point", size = 3) +
  labs(x="", y = "Salário", title = "Distribuição dos salários recebido pelos magistrados em dezembro de 2016") 


salario_min_2016 <- dados_2016 %>%  filter(subsidio > 0) %>% pull(subsidio) %>% min()
salario_max_2016 <- dados_2016 %>%pull(subsidio) %>% max()
mediana_salarial_2016 <- dados_2016 %>%pull(subsidio) %>% median() %>% round(2)
media_salarial_2016 <- dados_2016 %>%pull(subsidio) %>% mean() %>% round(2)
```

Analisando o ano de 2016 podemos observar que o salário mais baixo recebido foi de **`r format(salario_min_2016, decimal.mark = ",", big.mark = ".", nsmall = 2)`** por uma pensionista do	Tribunal de Justiça do Estado do Acre isso é equivalente a 5,75 salários mínimos. Já o salário mais alto foi de **`r format(salario_max_2016, decimal.mark = ",", big.mark = ".", nsmall = 2)`** recebido por uma desembargadora federal do trabalho, esse valor é equivalente a 66,4 salários mínimos.  

A média salarial foi de **`r format( media_salarial_2016, decimal.mark = ",", big.mark = ".", nsmall = 2)`** com uma mediana de **`r format(mediana_salarial_2016, decimal.mark = ",", big.mark = ".", nsmall = 2)`** 

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
#Distribuição dos salários
dados_2016 %>%
  drop_na(genero) %>% 
  ggplot(aes(x=genero, y=subsidio, color=genero)) +
  geom_violin() +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  scale_y_log10(labels = scales::comma, breaks=c(5000, 10000, 15000, 20000,25000, 35000, 50000, 65000)) +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.7,position=position_jitter(0.2)) +
  stat_summary(fun.y = mean, colour = "#000000", geom = "point", size = 3) +
  labs(x="", y = "Salário", title = "Distribuição dos salários de acordo com o genêro em dezembro de 2016") 


total_homem <- dados_2016 %>% drop_na(genero) %>% filter(genero == "Male") %>% count() %>%  pull(n)
total_mulher <- dados_2016 %>% drop_na(genero) %>% filter(genero == "Female") %>% count() %>%  pull(n)
media_salarial_mulher_2016 <- dados_2016 %>% drop_na(genero) %>% filter(genero == "Female") %>% pull(subsidio) %>%  mean() %>% round(2)
media_salarial_homem_2016 <- dados_2016 %>% drop_na(genero) %>% filter(genero == "Male") %>% pull(subsidio)  %>% mean() %>% round(2)

```

O total de funcionárias é de **`r total_mulher`**, enquanto o de funcionários é de **`r total_homem`**. Existem o dobro de funcionários do que de funcionárias no sistema de justiça brasileiro em dezembro de 2016. A média salárial para as mulheres é de **`r format(media_salarial_mulher_2016, decimal.mark = ",", big.mark = ".", nsmall = 2)`** e para os homems é de **`r format( media_salarial_homem_2016, decimal.mark = ",", big.mark = ".", nsmall = 2)`**.

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
n_male = dados_2016 %>% filter(genero == "Male") %>% nrow()
n_female = dados_2016 %>% filter(genero == "Female") %>% nrow()

# Create test data.

data <- data.frame(
  category=c("Mulher", "Homem"),
  count=c(n_female, n_male)
)
 
# Compute percentages
data$fraction <- (data$count / sum(data$count)) * 100
# Compute the cumulative percentages (top of each rectangle)
data$ymax <- cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin <- c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$category, "\n", round(data$fraction, digits = 0), "%")
# Make the plot
ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=category)) +
  geom_rect() +
  geom_text(x=3.5, aes(y=labelPosition, label=label, color=category), color = "white", size=3.2) + # x here controls label position (inner / outer)
  scale_fill_brewer(palette = "Set2") + theme_minimal() +
  scale_color_brewer(palette = "Set2") +
  coord_polar(theta="y") +
  xlim(c(1.8, 4)) +
  theme_void() + 
  labs(fill = "Cargo", title="Quantidade de mulheres e homems") +
  theme(legend.position = "none")
```

### Remuneração de acordo com cargo
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
library(stringr)
cargos_normalizados <- dados_2016 %>% 
  mutate( cargo_nomarlizado =
    case_when(
      str_detect(str_to_lower(cargo), "desembargador") ~ "Desembargador",
      str_detect(str_to_lower(cargo), "juiz") ~ "Juiz", 
      str_detect(str_to_lower(cargo), "pensionista") ~ "Pensionista",
      TRUE ~"Outros"
    )
  )
```

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
total_juiz = cargos_normalizados %>% filter(cargo_nomarlizado == "Juiz") %>% nrow()
total_desembagador = cargos_normalizados %>% filter(cargo_nomarlizado == "Desembargador") %>% nrow()
total_pensionista = cargos_normalizados %>% filter(cargo_nomarlizado == "Pensionista") %>% nrow()
total_outros = cargos_normalizados %>% filter(cargo_nomarlizado == "Outros") %>% nrow()


# Create test data.
data <- data.frame(
  category=c("Juiz", "Desembargador", "Pensionista", "Outros"),
  count=c(total_juiz, total_desembagador, total_pensionista, total_outros)
)
 
# Compute percentages
data$fraction <- (data$count / sum(data$count)) * 100
# Compute the cumulative percentages (top of each rectangle)
data$ymax <- cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin <- c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$category, "\n", round(data$fraction, digits = 0), "%")
# Make the plot
ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=category)) +
  geom_rect() +
  scale_fill_brewer(palette = "Set2") + theme_minimal() +
  scale_color_brewer(palette = "Set2") +
  coord_polar(theta="y") +
  xlim(c(1.8, 4)) +
  theme_void() + 
  labs(fill = "Cargo", title="Juizes são 80% dos funcionários em 2016") 
```




```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
cargos_normalizados %>%
  ggplot(aes(x=cargo_nomarlizado, y=total_de__rendimentos, color=cargo_nomarlizado )) +
  geom_violin() +
  theme_minimal() + 
  scale_y_log10(labels = scales::comma, breaks=c(5000, 10000, 20000, 35000, 50000, 80000, 150000, 250000)) + 
  scale_color_brewer(palette = "Set2") +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.5,position=position_jitter(0.2)) + labs(x="",color= "Tipo  de funcionário", y = "Remuneração",       title = "Distribuição das remunerações de acordo com o cargo em 2016") 
```




```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
media_remuneracao_2016_desembargador <- cargos_normalizados %>% 
  filter(cargo_nomarlizado == "Desembargador")  %>% 
  pull(total_de__rendimentos) %>% mean() %>% round(2)

media_remuneracao_2016_juiz <- cargos_normalizados %>% 
  filter(cargo_nomarlizado == "Juiz")  %>% 
  pull(total_de__rendimentos) %>% mean() %>% round(2)

media_remuneracao_2016_pensionista <- cargos_normalizados %>% 
  filter(cargo_nomarlizado == "Pensionista")  %>% 
  pull(total_de__rendimentos) %>% mean() %>% round(2)
```
A média de remunerção de acordo com cada cargo tem a seguinte distribuição: 

- A média de remuneração de um juiz em 2016 foi de:  **`r format(media_remuneracao_2016_juiz, decimal.mark = ",", big.mark = ".", nsmall = 2)`**
- A média de remuneração de um desembargador em 2016 foi de:  **`r format(media_remuneracao_2016_desembargador, decimal.mark = ",", big.mark = ".", nsmall = 2) `**
- A média de remuneração de um pensionitsa em 2016 foi de:  **`r  format(media_remuneracao_2016_pensionista, decimal.mark = ",", big.mark = ".", nsmall = 2) `**


### Judiciário x outros trabalhadores

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_2016 %>% 
  ggplot(aes(x = total_de__rendimentos, y = 12, color = "blabla")) +  
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  geom_point(shape = 124, size = 6, alpha=0.3) + 
  scale_y_continuous(breaks=seq(1, 11, by = 1)) + 
  scale_x_log10(labels = scales::comma) + 
  theme(legend.position = "none") + labs(x = "Valor da remuneração", y = "Mês", title = "Distribuição das remuneração em 2016") + 
  geom_point(aes(x = 15768), size = 4, color = "#111111", shape = 25) +
  annotate("text", label = "Remuneração média de 2016", x = 27775.73, y = 13, color = "#111111") +
  geom_point(aes(x = 12900), size = 4, color = "orange", shape = 25) +
  annotate("text", label = "Remuneração média Legislativo de 2016", x = 12900, y = 13.2, color = "orange") +
  geom_point(aes(x = 8100), size = 4, color = "blue", shape = 25) +
  annotate("text", label = "Remuneração média Executivo de 2016", x = 8100, y = 13.3, color = "blue") +
  geom_point(aes(x = 1045), size = 4, color = "red", shape = 25) +
  annotate("text", label = "Salário mínimo", x = 1045, y = 13.4, color = "red") +
  geom_point(aes(x = 27841), size = 4, color = "purple", shape = 25) +
  annotate("text", label = "Salário do presidente", x = 27841, y = 13.4, color = "purple")
```

## Desvendando os benefícios

Iremos chamar de benefício qualquer valor recebido pelo funcionário ou funcionária que não seja parte do valor recebido como salário, mas constitue sua remuneração.

Alguns dos benefícios são: 

* Diarias:Reembolso por despesas em serviços externos: alimentação, transporte, hospedagem e outros
* Abono Permanência: Bônus concedido a quem alcançou os requisitos para se aposentar, mas optou por permanecer em atividade
* Auxílio Alimentação: Indeniza gastos com alimentação
* Auxílio pré escolar: Também conhecido como auxílio creche, objetiva oferecer assistência ao atendimento de seus dependentes em idade pré-escolar
* Auxílio saúde: Concedido para custeio dos gastos com planos de saúde
* Auxílio natalidade: Concedido por motivo de nascimento de filho
* Auxilío moradia: Ressarcimento de despesas comprovadamente realizadas pelo servidor com aluguel de moradia ou com hospedagem em empresa hoteleira
* Ajuda de custo:  Inclui despesas como mudança de cidade do magistrado e auxílios diversos - como bolsa livro
* Abono Constitucional de 1/3 de férias
* Indenização de férias: Recebido quando o magistrado não utiliza todo o período de férias ao qual tem direito
* Gratificação natalina: 1/12 da remuneração por mês trabalhado, o que totaliza um salário extra por ano
  
TODO:  colocar o resto dos benefícios
  
### 30% dos valores gastos com remuneração são proveniente de benefícios
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
# Stacked barchart
stacked_bar_chart <- dados_2016 %>%
  mutate(`Salário` = subsidio, `Beneficios` = total_de__rendimentos - subsidio) %>% 
  gather(key="type", value ="value", `Salário`, `Beneficios`) %>% 
  select(value, type, mes) %>% 
  group_by(type, mes) %>% 
  summarise(sum = sum(value)) 


total_salario = stacked_bar_chart %>% filter(type == "Salário")%>% pull(sum) 
total_beneficio  = stacked_bar_chart %>% filter(type =="Beneficios") %>% pull(sum)
                                                                              
stacked_bar_chart %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity", width = 0.4) +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Proporção de salário x benefício em dez de 2016" ) +
    scale_y_continuous(labels = scales::comma) +
    theme(text = element_text(size=16))
``` 
Em dezembro de 2016 o total gasto com salário foi de **`r  format(total_salario, decimal.mark = ",", big.mark = ".", nsmall = 2)`**. Enquanto o total gasto com benefícios foi de **`r  format(total_beneficio, decimal.mark = ",", big.mark = ".", nsmall = 2)`**

### Sumários de alguns benefícios
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
stacked_bar_chart_auxilios <- dados_2016 %>%
  gather(key="type", value ="value", auxilio_alimentacao, auxilio_pre_escolar, auxilio_saude, auxilio_moradia, ajuda_de_custo, auxilio_natalidade) %>% 
  select(value, type, mes) %>% 
  group_by(type, mes) %>% 
  summarise(sum = sum(value, na.rm=T)) 

stacked_bar_chart_auxilios %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Distribuições dos auxílios em dezembro de 2016" ) +
    scale_y_continuous(labels = scales::comma) 
```
```{r}

# obter a ordenação do volume
idx <- order(stacked_bar_chart_auxilios$sum, decreasing = TRUE)
# criar os níveis ordenados
levels <- stacked_bar_chart_auxilios$type[idx]
# criar um factor com níveis ordenados
#stacked_bar_chart_auxilios$type <- factor(stacked_bar_chart_auxilios$type, levels=levels, ordered=TRUE)

stacked_bar_chart_auxilios %>% 
  ggplot(aes(x=sum, y=type, fill= type)) +
   scale_fill_brewer(palette = "Set2") +
  theme_minimal() + 
  geom_bar(stat="identity") + 
  scale_x_continuous( 
                                breaks = c(2000000,4000000, 6000000), 
                                labels = c("2M","4M", "6M")) +
  labs(x="Total gasto", y = "Tipo Auxílio", title = "Total gasto com cada tipo de auxílio", fill="Tipo de auxílio") +
   theme(text = element_text(size=16))
```

 
Os totais gastos com cada tipo de auxílio em dezembro de 2016 estão na tabela abaixo:

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}

kable(stacked_bar_chart_auxilios, escape = FALSE) %>%
  kable_styling("striped", full_width = FALSE)

```
 
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
stacked_bar_chart_outros <- dados_2016 %>%
  gather(key="type", value ="value", diarias, abono_de_permanencia, remuneracao_do_orgao_de_origem, abono_contitucional_de_1_3_de_ferias, indenizacao_de_ferias, antecipacao_de_ferias, gratificacao_natalina, 
antecipacao_de_gratificacao_natalina, substituicao, gratificacao_por_exercicio_cumulativo, gratificacao_por_encargo_curso_concurso) %>% 
  select(value, type, mes)  %>% 
  group_by(type, mes) %>% 
  summarise(sum = sum(value, na.rm=T)) 


stacked_bar_chart_outros %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Distribuições de outros benefícios em dezembro de 2016" ) +
    scale_y_continuous(labels = scales::comma) 
```

Os totais gastos com cada tipo de benefício de direito eventual e pessoal em dezembro de 2016 estão na tabela abaixo:

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
kable(stacked_bar_chart_outros, escape = FALSE) %>%
  kable_styling("striped", full_width = FALSE)
```

### 2017

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_11_2017 = read_csv(here("dados/2017-11-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc")
dados_11_2017 <- dados_11_2017 %>% mutate(mes = 11) %>% mutate(ano = 2017)

dados_12_2017 = read_csv(here("dados/2017-12-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc")

dados_12_2017 <- dados_12_2017 %>% mutate(mes = 12) %>% mutate(ano = 2017)

dados_2017 <- bind_rows(dados_11_2017, dados_12_2017)
dados_2017$genero <- get_gender(dados_2017$nome)

dados_2017 <- dados_2017 %>% filter(subsidio >= 0, direitos_pessoais >= 0, indenizacoes >= 0, direitos_eventuais >= 0, total_de_rendimentos >= 0, previdencia_publica >=0 , imposto_de_renda >= 0, descontos_diversos >= 0, retencao_por_teto_constitucional >= 0, total_de_descontos >= 0, rendimento_liquido >= 0, diarias >= 0, abono_de_permanencia >= 0, total_de_direitos_pessoais >= 0, auxilio_alimentacao >= 0, auxilio_saude >=0, total_indenizacoes >= 0, abono_contitucional_de_1_3_de_ferias >= 0, antecipacao_de_ferias >= 0, gratificacao_natalina >= 0, antecipacao_de_gratificacao_natalina >= 0, substituicao >= 0, gratificacao_por_exercicio_cumulativo >= 0, total_de_direitos_eventuais >=0) %>%filter(subsidio >= 1045)

summary(dados_2017)
```

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
#Distribuição dos salários
dados_2017 %>%
  ggplot(aes(x=" ", y=subsidio, color=" ")) +
  geom_violin() +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  theme(legend.position = "none") +
  scale_y_continuous(labels = scales::comma,breaks=c(5000, 10000, 15000, 20000,25000,30000, 35000, 50000, 65000)) +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.7,position=position_jitter(0.2)) +
  stat_summary(fun.y = mean, colour = "#F25E4B", geom = "point", size = 3) +
  labs(x="", y = "Salário", title = "Distribuição dos salários recebido pelos magistrados em dezembro de 2017") 


salario_min_2017 <- dados_2017 %>%  filter(subsidio > 0) %>% pull(subsidio) %>% min()
salario_max_2017 <- dados_2017 %>% pull(subsidio) %>% max()
mediana_salarial_2017 <- dados_2017 %>%pull(subsidio) %>% median() %>% round(2)
media_salarial_2017 <- dados_2017 %>%pull(subsidio) %>% mean() %>% round(2)
```

Salário minímo:  **`r  format(salario_min_2017, decimal.mark = ",", big.mark = ".", nsmall = 2)`**
Salário máximo:  **`r  format(salario_max_2017, decimal.mark = ",", big.mark = ".", nsmall = 2)`**
Salário médio:  **`r  format(media_salarial_2017 , decimal.mark = ",", big.mark = ".", nsmall = 2)`**
Salário mediano:  **`r  format(mediana_salarial_2017 , decimal.mark = ",", big.mark = ".", nsmall = 2)`**


```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
#Distribuição dos salários
dados_2017 %>%
  drop_na(genero) %>% 
  ggplot(aes(x=genero, y=subsidio, color=genero)) +
  geom_violin() +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  scale_y_continuous(labels = scales::comma, breaks=c(5000, 10000, 15000, 20000,25000,30000, 35000, 50000, 65000)) +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.7,position=position_jitter(0.2)) +
  stat_summary(fun.y = mean, colour = "#000000", geom = "point", size = 3) +
  labs(x="", y = "Salário", title = "Distribuição dos salários de acordo com o genêro em dezembro de 2017") 


total_homem_2017 <- dados_2017 %>% drop_na(genero) %>% filter(genero == "Male") %>% count() %>%  pull(n)
total_mulher_2017 <- dados_2017 %>% drop_na(genero) %>% filter(genero == "Female") %>% count() %>%  pull(n)
media_salarial_mulher_2017 <- dados_2017 %>% drop_na(genero) %>% filter(genero == "Female") %>% pull(subsidio) %>%  mean() %>% round(2)
media_salarial_homem_2017 <- dados_2017 %>% drop_na(genero) %>% filter(genero == "Male") %>% pull(subsidio)  %>% mean() %>% round(2)

```
Média salárial (mulher): **`r  format(media_salarial_mulher_2017 , decimal.mark = ",", big.mark = ".", nsmall = 2)`**
Média salárial (homem): **`r  format(media_salarial_homem_2017 , decimal.mark = ",", big.mark = ".", nsmall = 2)`**

Total (mulher) **`r total_mulher_2017`**
Total (homem) **`r total_mulher_2017`**

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
n_male_2017 = dados_2017 %>% filter(genero == "Male") %>% nrow()
n_female_2017 = dados_2017 %>% filter(genero == "Female") %>% nrow()

# Create test data.

data <- data.frame(
  category=c("Mulher", "Homem"),
  count=c(n_female_2017, n_male_2017)
)
 
# Compute percentages
data$fraction <- (data$count / sum(data$count)) * 100
# Compute the cumulative percentages (top of each rectangle)
data$ymax <- cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin <- c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$category, "\n", round(data$fraction, digits = 0), "%")
# Make the plot
ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=category)) +
  geom_rect() +
  geom_text(x=3.5, aes(y=labelPosition, label=label, color=category), color = "white", size=3.2) + # x here controls label position (inner / outer)
  scale_fill_brewer(palette = "Set2") + theme_minimal() +
  scale_color_brewer(palette = "Set2") +
  coord_polar(theta="y") +
  xlim(c(1.8, 4)) +
  theme_void() + 
  labs(fill = "Cargo", title="Quantidade de mulheres e homens") +
  theme(legend.position = "none")
```

```{r}
data %>% 
  ggplot(aes(x=category,y=count, fill=category)) + 
  geom_bar(stat="identity") + 
  labs(x="Gênero", y = "Quantidade", title = "Distribuição de gênero") 
```


```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
library(stringr)
cargos_normalizados <- dados_2017 %>% 
  mutate( cargo_nomarlizado =
    case_when(
      str_detect(str_to_lower(cargo), "desembargador") ~ "Desembargador",
      str_detect(str_to_lower(cargo), "des") ~ "Desembargador",
      str_detect(str_to_lower(cargo), "juiz") ~ "Juiz", 
      str_detect(str_to_lower(cargo), "pensionista") ~ "Pensionista",
         str_detect(str_to_lower(cargo), "aposentado") ~ "Pensionista",
      TRUE ~"Outros"
    )
  )
```

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
total_juiz = cargos_normalizados %>% filter(cargo_nomarlizado == "Juiz") %>% nrow()
total_desembagador = cargos_normalizados %>% filter(cargo_nomarlizado == "Desembargador") %>% nrow()
total_pensionista = cargos_normalizados %>% filter(cargo_nomarlizado == "Pensionista") %>% nrow()
total_outros = cargos_normalizados %>% filter(cargo_nomarlizado == "Outros") %>% nrow()

# Create test data.
data <- data.frame(
  category=c("Juiz", "Desembargador", "Pensionista", "Outros"),
  count=c(total_juiz, total_desembagador, total_pensionista, total_outros)
)
 
# Compute percentages
data$fraction <- (data$count / sum(data$count)) * 100
# Compute the cumulative percentages (top of each rectangle)
data$ymax <- cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin <- c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$category, "\n", round(data$fraction, digits = 0), "%")
# Make the plot
ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=category)) +
  geom_rect() +
  scale_fill_brewer(palette = "Set2") + theme_minimal() +
  scale_color_brewer(palette = "Set2") +
  coord_polar(theta="y") +
  xlim(c(1.8, 4)) +
  theme_void() + 
  labs(fill = "Cargo", title="Juizes são 79% dos funcionários em 2017")
```

```{r}
data %>% 
  ggplot(aes(x=category,y=count, fill=category)) + 
  geom_bar(stat="identity") + 
  labs(x="Cargo", y = "Quantidade", title = "Distribuição de cargos") 
```


```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
cargos_normalizados %>% filter(total_de_rendimentos < 500000 && subsidio >= 1045) %>% 
  ggplot(aes(x=cargo_nomarlizado, y=subsidio, color=cargo_nomarlizado )) +
  geom_violin() +
  theme_minimal() + 
  scale_y_continuous(labels = scales::comma,breaks=c(3000,6000, 15000,27000,30000,40000, 50000, 65000, 100000, 200000, 300000)) + 
  scale_color_brewer(palette = "Set2") +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.5,position=position_jitter(0.2)) + labs(x="",color= "Tipo  de funcionário", y = "Remuneração",       title = "Distribuição salarial de acordo com o cargo em 2017") +
  theme(text= element_text(size=16))
```



```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_2017 %>% filter(total_de_rendimentos < 500000) %>% 
  ggplot(aes(x = total_de_rendimentos, y = mes, color = "blabla")) +  
  theme(axis.text.x=element_text(angle=90, hjust=1)) +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  geom_point(shape = 124, size = 6, alpha=0.3) + 
  scale_y_continuous(breaks=seq(1, 12, by = 1)) + 
  scale_x_continuous(labels = scales::comma,breaks=c(5000, 15000,27000,30000, 50000, 65000)) + 
  theme(legend.position = "none") + labs(x = "Valor da remuneração", y = "Mês", title = "Distribuição das remuneração em 201") + 
  geom_point(aes(x = 15768), size = 4, color = "#111111", shape = 25) +
  annotate("text", label = "Remuneração média de 2017", x = 28947.73, y = 13, color = "#111111") +
  geom_point(aes(x = 12900), size = 4, color = "orange", shape = 25) +
  annotate("text", label = "Remuneração média Legislativo de 2016", x = 12900, y = 13.2, color = "orange") +
  geom_point(aes(x = 8100), size = 4, color = "blue", shape = 25) +
  annotate("text", label = "Remuneração média Executivo de 2016", x = 8100, y = 13.3, color = "blue") +
  geom_point(aes(x = 1045), size = 4, color = "red", shape = 25) +
  annotate("text", label = "Salário mínimo", x = 1045, y = 13.4, color = "red") +
  geom_point(aes(x = 27841), size = 4, color = "purple", shape = 25) +
  annotate("text", label = "Salário do presidente", x = 27841, y = 13.4, color = "purple")
```


```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
# Stacked barchart
stacked_bar_chart <- dados_2017 %>%
  mutate(`Salário` = subsidio, `Beneficios` = total_de_rendimentos - subsidio) %>% 
  gather(key="type", value ="value", `Salário`, `Beneficios`) %>% 
  select(value, type, mes) %>% 
  group_by(type, mes) %>% 
  summarise(sum = sum(value)) 


total_salario = stacked_bar_chart %>% filter(type == "Salário")%>% pull(sum) 
total_beneficio  = stacked_bar_chart %>% filter(type =="Beneficios") %>% pull(sum)
                                                                              
stacked_bar_chart %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Distribuições das remunerações em 2017" ) +
    scale_y_continuous(labels = scales::comma) 
``` 
 
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
stacked_bar_chart_auxilios <- dados_2017 %>%
  gather(key="type", value ="value", auxilio_alimentacao, auxilio_pre_escolar, auxilio_saude, auxilio_moradia, ajuda_de_custo, auxilio_natalidade) %>% 
  select(value, type, mes) %>% 
  group_by(type, mes) %>% 
  summarise(sum = sum(value, na.rm=T)) 

stacked_bar_chart_auxilios %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Distribuições dos auxílios em 2017" ) +
    scale_y_continuous(labels = scales::comma) 
```
Os totais gastos com cada tipo de auxílio em dezembro de 2016 estão na tabela abaixo:

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}

kable(stacked_bar_chart_auxilios, escape = FALSE) %>%
  kable_styling("striped", full_width = FALSE)

```
 
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
stacked_bar_chart_outros <- dados_2017 %>%
  gather(key="type", value ="value", diarias, abono_de_permanencia, remuneracao_do_orgao_de_origem, abono_contitucional_de_1_3_de_ferias, indenizacao_de_ferias, antecipacao_de_ferias, gratificacao_natalina, 
antecipacao_de_gratificacao_natalina, substituicao, gratificacao_por_exercicio_cumulativo, gratificacao_por_encargo_curso_concurso) %>% 
  select(value, type, mes)  %>% 
  group_by(type, mes) %>% 
  summarise(sum = sum(value, na.rm=T)) 


stacked_bar_chart_outros %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Distribuições de outros benefícios em dezembro de 2017" ) +
    scale_y_continuous(labels = scales::comma) 
```

Os totais gastos com cada tipo de benefício de direito eventual e pessoal em dezembro de 2016 estão na tabela abaixo:

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
kable(stacked_bar_chart_outros, escape = FALSE) %>%
  kable_styling("striped", full_width = FALSE)
```


### 2018

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_1_2018 = read_csv(here("dados/2018-1-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 1) %>% mutate(ano = 2018)
dados_1_2018 <- rename(dados_1_2018, total_de_rendimentos = total_de__rendimentos)
dados_1_2018$total_de__rendimentos <- NULL

dados_2_2018 = read_csv(here("dados/2018-2-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 2) %>% mutate(ano = 2018)

dados_3_2018 = read_csv(here("dados/2018-3-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 3) %>% mutate(ano = 2018)
dados_3_2018 <- rename(dados_3_2018, total_de_rendimentos = total_de__rendimentos)
dados_3_2018$total_de__rendimentos <- NULL

dados_4_2018 = read_csv(here("dados/2018-4-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 4) %>% mutate(ano = 2018)

dados_5_2018 = read_csv(here("dados/2018-5-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 5) %>% mutate(ano = 2018)

dados_6_2018 = read_csv(here("dados/2018-6-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 6) %>% mutate(ano = 2018)

dados_7_2018 = read_csv(here("dados/2018-7-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 7) %>% mutate(ano = 2018)

dados_8_2018 = read_csv(here("dados/2018-8-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 8) %>% mutate(ano = 2018)

dados_9_2018 = read_csv(here("dados/2018-9-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 9) %>% mutate(ano = 2018)

dados_10_2018 = read_csv(here("dados/2018-10-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 10) %>% mutate(ano = 2018)

dados_11_2018 = read_csv(here("dados/2018-11-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 11) %>% mutate(ano = 2018)

dados_12_2018 = read_csv(here("dados/2018-12-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 12) %>% mutate(ano = 2018)
dados_12_2018 <- rename(dados_12_2018, total_de_rendimentos = total_de__rendimentos)
dados_12_2018$total_de__rendimentos <- NULL





dados_2018 <- bind_rows(dados_1_2018, dados_2_2018, dados_3_2018, dados_4_2018, dados_5_2018, dados_6_2018, dados_7_2018,dados_8_2018, dados_9_2018, dados_10_2018, dados_11_2018, dados_12_2018)



dados_2018 <- dados_2018 %>% filter(subsidio >= 0, direitos_pessoais >= 0, indenizacoes >= 0, direitos_eventuais >= 0, total_de_rendimentos>= 0, previdencia_publica >= 0 , imposto_de_renda >= 0, descontos_diversos >= 0, retencao_por_teto_constitucional >= 0, total_de_descontos >= 0, rendimento_liquido >= 0, diarias >= 0, abono_de_permanencia >= 0, total_de_direitos_pessoais >= 0, auxilio_alimentacao >= 0, auxilio_saude >= 0, total_indenizacoes >= 0, abono_contitucional_de_1_3_de_ferias >= 0, antecipacao_de_ferias >= 0, gratificacao_natalina >= 0, antecipacao_de_gratificacao_natalina >= 0, substituicao >= 0, gratificacao_por_exercicio_cumulativo >= 0, total_de_direitos_eventuais >= 0) %>% filter(subsidio >= 1045) %>% filter(total_de_rendimentos >= 1045)

dados_2018$genero <- get_gender(dados_2018$nome)



summary(dados_2018)
```


```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
#Distribuição dos salários
dados_2018 %>%
  ggplot(aes(x=" ", y=subsidio)) +
  geom_violin() +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  scale_y_continuous(labels = scales::comma) +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.7,position=position_jitter(0.2)) +
  stat_summary(fun.y = mean, colour = "#F25E4B", geom = "point", size = 3) +
  labs(x="", y = "Salário", title = "Distribuição dos salários recebido pelos magistrados em dezembro de 2017") 


salario_min_2018 <- dados_2018 %>%  filter(subsidio > 0) %>% pull(subsidio) %>% min()
salario_max_2018 <- dados_2018 %>% pull(subsidio) %>% max()
mediana_salarial_2018 <- dados_2018 %>%pull(subsidio) %>% median() %>% round(2)
media_salarial_2018 <- dados_2018 %>%pull(subsidio) %>% mean() %>% round(2)
```

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
#Distribuição dos salários
dados_2018 %>%
  drop_na(genero) %>% 
  ggplot(aes(x=genero, y=subsidio, color=genero)) +
  geom_violin() +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  scale_y_continuous(labels = scales::comma, breaks=c(5000, 10000, 15000, 20000,25000,30000, 35000, 50000, 65000)) +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.7,position=position_jitter(0.2)) +
  stat_summary(fun.y = mean, colour = "#000000", geom = "point", size = 3) +
  labs(x="", y = "Salário", title = "Distribuição dos salários de acordo com o genêro em dezembro de 2017") 


total_homem_2018 <- dados_2018 %>% drop_na(genero) %>% filter(genero == "Male") %>% count() %>%  pull(n)
total_mulher_2018 <- dados_2018 %>% drop_na(genero) %>% filter(genero == "Female") %>% count() %>%  pull(n)
media_salarial_mulher_2018 <- dados_2018 %>% drop_na(genero) %>% filter(genero == "Female") %>% pull(subsidio) %>%  mean() %>% round(2)
media_salarial_homem_2018 <- dados_2018 %>% drop_na(genero) %>% filter(genero == "Male") %>% pull(subsidio)  %>% mean() %>% round(2)

```

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
n_male_2018 = dados_2018 %>% filter(genero == "Male") %>% nrow()
n_female_2018 = dados_2018 %>% filter(genero == "Female") %>% nrow()

# Create test data.

data <- data.frame(
  category=c("Mulher", "Homem"),
  count=c(n_female_2018, n_male_2018)
)
 
# Compute percentages
data$fraction <- (data$count / sum(data$count)) * 100
# Compute the cumulative percentages (top of each rectangle)
data$ymax <- cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin <- c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$category, "\n", round(data$fraction, digits = 0), "%")
# Make the plot
ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=category)) +
  geom_rect() +
  geom_text(x=3.5, aes(y=labelPosition, label=label, color=category), color = "white", size=3.2) + # x here controls label position (inner / outer)
  scale_fill_brewer(palette = "Set2") + theme_minimal() +
  scale_color_brewer(palette = "Set2") +
  coord_polar(theta="y") +
  xlim(c(1.8, 4)) +
  theme_void() + 
  labs(fill = "Cargo", title="Quantidade de mulheres e homems") +
  theme(legend.position = "none")
```



```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
library(stringr)
cargos_normalizados <- dados_2018 %>% 
  mutate( cargo_nomarlizado =
    case_when(
      str_detect(str_to_lower(cargo), "desembargador") ~ "Desembargador",
      str_detect(str_to_lower(cargo), "des") ~ "Desembargador",
      str_detect(str_to_lower(cargo), "juiz") ~ "Juiz", 
      str_detect(str_to_lower(cargo), "pensionista") ~ "Pensionista",
         str_detect(str_to_lower(cargo), "aposentado") ~ "Pensionista",
      TRUE ~"Outros"
    )
  )
```

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
total_juiz = cargos_normalizados %>% filter(cargo_nomarlizado == "Juiz") %>% nrow()
total_desembagador = cargos_normalizados %>% filter(cargo_nomarlizado == "Desembargador") %>% nrow()
total_pensionista = cargos_normalizados %>% filter(cargo_nomarlizado == "Pensionista") %>% nrow()
total_outros = cargos_normalizados %>% filter(cargo_nomarlizado == "Outros") %>% nrow()

# Create test data.
data <- data.frame(
  category=c("Juiz", "Desembargador", "Pensionista", "Outros"),
  count=c(total_juiz, total_desembagador, total_pensionista, total_outros)
)
 
# Compute percentages
data$fraction <- (data$count / sum(data$count)) * 100
# Compute the cumulative percentages (top of each rectangle)
data$ymax <- cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin <- c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$category, "\n", round(data$fraction, digits = 0), "%")
# Make the plot
ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=category)) +
  geom_rect() +
  geom_text(x=3.5, aes(y=labelPosition, label=label, color=category), color = "white", size=3.2) + # x here controls label position (inner / outer)
  scale_fill_brewer(palette = "Set2") + theme_minimal() +
  scale_color_brewer(palette = "Set2") +
  coord_polar(theta="y") +
  xlim(c(1.8, 4)) +
  theme_void() + 
  labs(fill = "Cargo", title="Juizes são 77% dos funcionários em 2017") +
  theme(legend.position = "none")
```

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
cargos_normalizados %>% filter(subsidio >= 1045, subsidio <= 65000) %>% 
  ggplot(aes(x=cargo_nomarlizado, y=subsidio, color=cargo_nomarlizado )) +
  geom_violin() +
  theme_minimal() + 
  scale_y_continuous(labels = scales::comma,breaks=c(5000, 10000, 15000, 20000,25000,30000, 35000, 50000, 65000) ) + 
  scale_color_brewer(palette = "Set2") +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.5,position=position_jitter(0.2)) + labs(x="",color= "Tipo de funcionário", y = "Remuneração",       title = "Distribuição salarial de acordo com o cargo em 2018") +
   theme(text= element_text(size=16))+
    theme(axis.text.x = element_text(size=13), title = element_text(size = 16 )) 

```



```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_2018 %>% 
  ggplot(aes(x = total_de_rendimentos, y = mes, color = "blabla")) +  
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  geom_point(shape = 124, size = 6, alpha=0.9) + 
  scale_y_continuous(breaks=seq(1, 12, by = 1)) + 
  scale_x_log10(labels = scales::comma) + 
  theme(legend.position = "none") + labs(x = "Valor da remuneração", y = "Mês", title = "Distribuição das remuneração em 2018") + 
  geom_point(aes(x = 15768), size = 4, color = "#111111", shape = 124) +
  annotate("text", label = "Remuneração média de 2018", x = 27775.73, y = 13, color = "#111111") +
  geom_point(aes(x = 12900), size = 4, color = "orange", shape =124) +
  annotate("text", label = "Remuneração média Legislativo de 2016", x = 12900, y = 14, color = "orange") +
  geom_point(aes(x = 8100), size = 4, color = "blue", shape = 124) +
  annotate("text", label = "Remuneração média Executivo de 2016", x = 8100, y = 14.5, color = "blue") +
  geom_point(aes(x = 1045), size = 4, color = "red", shape = 124) +
  annotate("text", label = "Salário mínimo", x = 1045, y = 13, color = "red") +
  geom_point(aes(x = 27841), size = 4, color = "purple", shape = 124) +
  annotate("text", label = "Salário do presidente", x = 27841, y = 13.5, color = "purple")
```


```{r}
data_outros_salarios <- data.frame(
  categoria=c("Remuneração média de 2018", "Remuneração média Legislativo de 2016", "Remuneração média Executivo de 2016", "Salário mínimo", "Salário do presidente" ),
  total_de_rendimentos=c(38199, 12900, 8100, 1045, 27841)
)



library(scales)
l <- dados_2018  %>% 
  ggplot() + geom_violin(aes(x=month.abb[mes], y=log2(total_de_rendimentos)),
                                      color="#2D608B",
                                      fill="#BFD7EA",
                                      alpha=0.8,
                                      notch=TRUE,
                                      notchwidth = 0.8) + 
    
                          scale_x_discrete(limits = month.abb) +
                        scale_y_continuous( 
                                breaks = c(9.9,12.3, 13.9, 15.2, 16.6, 18.3), 
                                labels = c("1mil","5mil", "15mil"  , "38mil", "100mil", "500mil")) +
                          
  theme(text = element_text(size=15)) +
  labs(y = "Valor remuneração", x="", title = "Distribuição de remuneração em 2018", color = "Outras remunerações") +
  geom_hline(data = data_outros_salarios, aes(yintercept = log2(total_de_rendimentos), color = categoria), linetype = "dashed", size = 1) + scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom",legend.direction = "vertical",legend.box.spacing = unit(0, "cm"), legend.text = element_text(size=12), legend.title = element_text(size=12))
  
l

ggsave(l, filename = "./plot.png",height = 5, width = 7)


#geom_hline(yintercept = 10, linetype="dashed", color = "#0B3954") + 
  #annotate("text", label = "Salário Mínimo", x = 1.5, y = 10.2, color = "#0B3954") + 
  #geom_hline(yintercept = 15.22, linetype="dashed", color = "#FF4A47") + 
  #annotate("text", label = "Remuneração média de 2018", x = 2.5, y = 15.42, color = "#FF4A47")  +
  #geom_hline(yintercept = 13.65,  linetype="dashed",color = "#96B800") + 
  #annotate("text", label = "Remuneração média Legislativo de 2016", x = 3.2, y = 13.85, color = "#96B800") +
  #geom_hline(yintercept = 12.98, linetype="dashed", color = "#8F6593") + 
  #annotate("text", label = "Remuneração média Executivo de 2016", x = 3.2, y = 13.2, color = "#8F6593") +
  #geom_hline(yintercept = 14.76,  linetype="dashed", color = "#8f7c00") + 
  #annotate("text", label = "Salário do presidente", x = 2, y = 14.96, color = "#8f7c00")
  

```


```{r}
dados_2018 %>% group_by(mes) %>%  summarise(sum  =  sum (subsidio)) 
```


```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
# Stacked barchart
stacked_bar_chart <- dados_2018 %>%
  mutate(`Salário` = subsidio, `Beneficios` = total_de_rendimentos - subsidio) %>% 
  gather(key="type", value ="value", `Salário`, `Beneficios`) %>% 
  select(value, type, mes) %>% 
  group_by(type, mes) %>% 
  summarise(sum = sum(value)) 


total_salario_2018 = stacked_bar_chart %>% filter(type == "Salário")%>% pull(sum) %>% sum()
total_beneficio_2018  = stacked_bar_chart %>% filter(type =="Beneficios") %>% pull(sum) %>% sum()
                                                                              
stacked_bar_chart %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Proporção de salário x benefício em 2018" ) +
    scale_y_continuous(labels = scales::comma) +
    theme(text = element_text(size=16))
  


``` 
 
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
stacked_bar_chart_auxilios <- dados_2018 %>%
  gather(key="type", value ="value", auxilio_alimentacao, auxilio_pre_escolar, auxilio_saude, auxilio_moradia, ajuda_de_custo, auxilio_natalidade) %>% 
  select(value, type, mes) %>% 
  group_by(type, mes) %>% 
  summarise(sum = sum(value, na.rm=T)) 

stacked_bar_chart_auxilios %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Tipo de auxílio", title = "Distribuições dos auxílios em 2018" ) +
    scale_y_continuous(labels = scales::comma) +
   theme(text= element_text(size=16))
```
Os totais gastos com cada tipo de auxílio em dezembro de 2016 estão na tabela abaixo:

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}

kable(stacked_bar_chart_auxilios, escape = FALSE) %>%
  kable_styling("striped", full_width = FALSE)

```
 
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
stacked_bar_chart_outros <- dados_2018 %>%
  gather(key="type", value ="value", diarias, abono_de_permanencia, remuneracao_do_orgao_de_origem, abono_contitucional_de_1_3_de_ferias, indenizacao_de_ferias, antecipacao_de_ferias, gratificacao_natalina, 
antecipacao_de_gratificacao_natalina, substituicao, gratificacao_por_exercicio_cumulativo, gratificacao_por_encargo_curso_concurso) %>% 
  select(value, type, mes)  %>% 
  group_by(type, mes) %>% 
  summarise(sum = sum(value, na.rm=T)) 


stacked_bar_chart_outros %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set3") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Distribuições de outros benefícios em 2018" ) +
    scale_y_continuous(labels = scales::comma) +
  theme(text= element_text(size=16), legend.text=element_text(size=10))
```

Os totais gastos com cada tipo de benefício de direito eventual e pessoal em dezembro de 2018 estão na tabela abaixo:

```{r}
sum(dados_2018$gratificacao_por_encargo_curso_concurso)
```


```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
kable(stacked_bar_chart_outros, escape = FALSE) %>%
  kable_styling("striped", full_width = FALSE)
```



### 2019
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}

dados_1_2019 = read_csv(here("dados/2019-1-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 1) %>% mutate(ano = 2019)

dados_2_2019 = read_csv(here("dados/2019-2-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 2) %>% mutate(ano = 2019)

dados_12_2019 = read_csv(here("dados/2019-12-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 12) %>% mutate(ano = 2019)

dados_2019 <-  bind_rows(dados_1_2019, dados_2_2019, dados_12_2019)

dados_2019 <-  dados_2019 %>% 
filter(subsidio >= 0, direitos_pessoais >= 0, indenizacoes >= 0, direitos_eventuais >= 0, total_de_rendimentos >= 0, previdencia_publica >=0 , imposto_de_renda >= 0, descontos_diversos >= 0, retencao_por_teto_constitucional >= 0, total_de_descontos >= 0, rendimento_liquido >= 0, diarias >= 0, abono_de_permanencia >= 0, total_de_direitos_pessoais >= 0, auxilio_alimentacao >= 0, auxilio_saude >=0, total_indenizacoes >= 0, abono_contitucional_de_1_3_de_ferias >= 0, antecipacao_de_ferias >= 0, gratificacao_natalina >= 0, antecipacao_de_gratificacao_natalina >= 0, substituicao >= 0, gratificacao_por_exercicio_cumulativo >= 0, total_de_direitos_eventuais >=0) %>% filter(subsidio > 1045)



dados_2019$genero <- get_gender(dados_2019$nome)

summary(dados_2019)
```


```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
#Distribuição dos salários
dados_2019 %>%
  ggplot(aes(x=" ", y=subsidio)) +
  geom_violin() +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  scale_y_continuous(labels = scales::comma) +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.7,position=position_jitter(0.2)) +
  stat_summary(fun.y = mean, colour = "#F25E4B", geom = "point", size = 3) +
  labs(x="", y = "Salário", title = "Distribuição dos salários recebido pelos magistrados em dezembro de 2017") 


salario_min_2019 <- dados_2019 %>%  filter(subsidio > 0) %>% pull(subsidio) %>% min()
salario_max_2019 <- dados_2019 %>% pull(subsidio) %>% max()
mediana_salarial_2019 <- dados_2019 %>%pull(subsidio) %>% median() %>% round(2)
media_salarial_2019 <- dados_2019 %>%pull(subsidio) %>% mean() %>% round(2)
```

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
#Distribuição dos salários
dados_2019 %>%
  drop_na(genero) %>% 
  ggplot(aes(x=genero, y=subsidio, color=genero)) +
  geom_violin() +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  scale_y_continuous(labels = scales::comma, breaks=c(5000, 10000, 15000, 20000,25000,30000, 35000, 50000, 65000)) +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.7,position=position_jitter(0.2)) +
  stat_summary(fun.y = mean, colour = "#000000", geom = "point", size = 3) +
  labs(x="", y = "Salário", title = "Distribuição dos salários de acordo com o genêro em dezembro de 2017") 


total_homem_2019 <- dados_2019 %>% drop_na(genero) %>% filter(genero == "Male") %>% count() %>%  pull(n)
total_mulher_2019 <- dados_2019 %>% drop_na(genero) %>% filter(genero == "Female") %>% count() %>%  pull(n)
media_salarial_mulher_2019 <- dados_2019 %>% drop_na(genero) %>% filter(genero == "Female") %>% pull(subsidio) %>%  mean() %>% round(2)
media_salarial_homem_2019 <- dados_2019 %>% drop_na(genero) %>% filter(genero == "Male") %>% pull(subsidio)  %>% mean() %>% round(2)

```

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
n_male_2019 = dados_2019%>% filter(genero == "Male") %>% nrow()
n_female_2019 = dados_2019 %>% filter(genero == "Female") %>% nrow()

# Create test data.

data <- data.frame(
  category=c("Mulher", "Homem"),
  count=c(n_female_2019, n_male_2019)
)
 
# Compute percentages
data$fraction <- (data$count / sum(data$count)) * 100
# Compute the cumulative percentages (top of each rectangle)
data$ymax <- cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin <- c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$category, "\n", round(data$fraction, digits = 0), "%")
# Make the plot
ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=category)) +
  geom_rect() +
  geom_text(x=3.5, aes(y=labelPosition, label=label, color=category), color = "white", size=3.2) + # x here controls label position (inner / outer)
  scale_fill_brewer(palette = "Set2") + theme_minimal() +
  scale_color_brewer(palette = "Set2") +
  coord_polar(theta="y") +
  xlim(c(1.8, 4)) +
  theme_void() + 
  labs(fill = "Cargo", title="Quantidade de mulheres e homems") +
  theme(legend.position = "none")
```



```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
library(stringr)
cargos_normalizados <- dados_2019 %>% 
  mutate( cargo_nomarlizado =
    case_when(
      str_detect(str_to_lower(cargo), "desembargador") ~ "Desembargador",
      str_detect(str_to_lower(cargo), "des") ~ "Desembargador",
      str_detect(str_to_lower(cargo), "juiz") ~ "Juiz", 
      str_detect(str_to_lower(cargo), "pensionista") ~ "Pensionista",
         str_detect(str_to_lower(cargo), "aposentado") ~ "Pensionista",
      TRUE ~"Outros"
    )
  )
```

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
total_juiz = cargos_normalizados %>% filter(cargo_nomarlizado == "Juiz") %>% nrow()
total_desembagador = cargos_normalizados %>% filter(cargo_nomarlizado == "Desembargador") %>% nrow()
total_pensionista = cargos_normalizados %>% filter(cargo_nomarlizado == "Pensionista") %>% nrow()
total_outros = cargos_normalizados %>% filter(cargo_nomarlizado == "Outros") %>% nrow()

# Create test data.
data <- data.frame(
  category=c("Juiz", "Desembargador", "Pensionista", "Outros"),
  count=c(total_juiz, total_desembagador, total_pensionista, total_outros)
)
 
# Compute percentages
data$fraction <- (data$count / sum(data$count)) * 100
# Compute the cumulative percentages (top of each rectangle)
data$ymax <- cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin <- c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$category, "\n", round(data$fraction, digits = 0), "%")
# Make the plot
ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=category)) +
  geom_rect() +
  geom_text(x=3.5, aes(y=labelPosition, label=label, color=category), color = "white", size=3.2) + # x here controls label position (inner / outer)
  scale_fill_brewer(palette = "Set2") + theme_minimal() +
  scale_color_brewer(palette = "Set2") +
  coord_polar(theta="y") +
  xlim(c(1.8, 4)) +
  theme_void() + 
  labs(fill = "Cargo", title="Juizes são 77% dos funcionários em 2017") +
  theme(legend.position = "none")
```

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
cargos_normalizados %>%
  ggplot(aes(x=cargo_nomarlizado, y=total_de_rendimentos, color=cargo_nomarlizado )) +
  geom_violin() +
  theme_minimal() + 
  scale_y_continuous(labels = scales::comma) + 
  scale_color_brewer(palette = "Set2") +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.5,position=position_jitter(0.2)) + labs(x="",color= "Tipo  de funcionário", y = "Remuneração",       title = "Distribuição das remunerações de acordo com o cargo em 2017") 
```



```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_2019 %>% 
  ggplot(aes(x = total_de_rendimentos, y = mes, color = "blabla")) +  
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  geom_point(shape = 124, size = 6, alpha=0.3) + 
  scale_y_continuous(breaks=seq(1, 12, by = 1)) + 
  scale_x_log10(labels = scales::comma) + 
  theme(legend.position = "none") + labs(x = "Valor da remuneração", y = "Mês", title = "Distribuição das remuneração em 201") + 
  geom_point(aes(x = 15768), size = 4, color = "#111111", shape = 25) +
  annotate("text", label = "Remuneração média de 2016", x = 27775.73, y = 13, color = "#111111") +
  geom_point(aes(x = 12900), size = 4, color = "orange", shape = 25) +
  annotate("text", label = "Remuneração média Legislativo de 2016", x = 12900, y = 13.2, color = "orange") +
  geom_point(aes(x = 8100), size = 4, color = "blue", shape = 25) +
  annotate("text", label = "Remuneração média Executivo de 2016", x = 8100, y = 13.3, color = "blue") +
  geom_point(aes(x = 1045), size = 4, color = "red", shape = 25) +
  annotate("text", label = "Salário mínimo", x = 1045, y = 13.4, color = "red") +
  geom_point(aes(x = 27841), size = 4, color = "purple", shape = 25) +
  annotate("text", label = "Salário do presidente", x = 27841, y = 13.4, color = "purple")
```


```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
# Stacked barchart
stacked_bar_chart <- dados_2019 %>%
  mutate(`Salário` = subsidio, `Beneficios` = total_de_rendimentos - subsidio) %>% 
  gather(key="type", value ="value", `Salário`, `Beneficios`) %>% 
  select(value, type, mes) %>% 
  group_by(type, mes) %>% 
  summarise(sum = sum(value)) 


total_salario = stacked_bar_chart %>% filter(type == "Salário")%>% pull(sum) 
total_beneficio  = stacked_bar_chart %>% filter(type =="Beneficios") %>% pull(sum)
                                                                              
stacked_bar_chart %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Distribuições das remunerações em 2017" ) +
    scale_y_continuous(labels = scales::comma) 
``` 
 
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
stacked_bar_chart_auxilios <- dados_2019 %>%
  gather(key="type", value ="value", auxilio_alimentacao, auxilio_pre_escolar, auxilio_saude, auxilio_moradia, ajuda_de_custo, auxilio_natalidade) %>% 
  select(value, type, mes) %>% 
  group_by(type, mes) %>% 
  summarise(sum = sum(value, na.rm=T)) 

stacked_bar_chart_auxilios %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Distribuições dos auxílios em dezembro de 2016" ) +
    scale_y_continuous(labels = scales::comma) 
```
Os totais gastos com cada tipo de auxílio em dezembro de 2016 estão na tabela abaixo:

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}

kable(stacked_bar_chart_auxilios, escape = FALSE) %>%
  kable_styling("striped", full_width = FALSE)

```
 
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
stacked_bar_chart_outros <- dados_2019 %>%
  gather(key="type", value ="value", diarias, abono_de_permanencia, remuneracao_do_orgao_de_origem, abono_contitucional_de_1_3_de_ferias, indenizacao_de_ferias, antecipacao_de_ferias, gratificacao_natalina, 
antecipacao_de_gratificacao_natalina, substituicao, gratificacao_por_exercicio_cumulativo, gratificacao_por_encargo_curso_concurso) %>% 
  select(value, type, mes)  %>% 
  group_by(type, mes) %>% 
  summarise(sum = sum(value, na.rm=T)) 


stacked_bar_chart_outros %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Distribuições de outros benefícios em dezembro de 2018" ) +
    scale_y_continuous(labels = scales::comma) 
```

Os totais gastos com cada tipo de benefício de direito eventual e pessoal em dezembro de 2018 estão na tabela abaixo:

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
kable(stacked_bar_chart_outros, escape = FALSE) %>%
  kable_styling("striped", full_width = FALSE)
```


### Dados juntos pra plots dos 4 anos

```{r}

dados_2016$total_de_rendimentos <- dados_2016$total_de__rendimentos
  
dados_juntos <- bind_rows(dados_2016, dados_2017, dados_2018, dados_2019)

dados_juntos_copy <- bind_rows(dados_2016, dados_2017, dados_2018, dados_2019)

dados_juntos$ano <- as.factor(dados_juntos$ano)

qauntidade_abaixo_minimo  <- dados_juntos %>%  filter(subsidio < 1045)

quan_salario_zero <- dados_juntos %>%  filter(subsidio == 0)

# 32,074

dados_juntos <- dados_juntos %>% filter(subsidio >= 1045)

dados_juntos %>% 
  ggplot(aes(x=ano, y=subsidio, color=ano)) +
  geom_boxplot() +
  theme_minimal() +
  scale_y_log10(labels = scales::comma, breaks=c(1050, 3000, 5000, 10000, 15000, 20000,25000, 35000, 50000, 65000)) +
  theme(legend.position = "none", text = element_text(size=12)) +
  labs(y = "Valor Salário em R$", x = "Ano", title = "Distribuições do valor de salário") + 
  theme(axis.text.x = element_text(size=16), title = element_text(size = 16 ), axis.text.y = element_text(size=15))

summary(dados_juntos)
```

```{r}
dados_juntos %>% group_by(nome) %>% summarize(count=n())
```


```{r}
total_maior_que_cem_mil <- dados_juntos %>% filter(total_de_rendimentos >= 100000) %>% nrow()

dados_juntos %>% 
  ggplot(aes(x=ano, y=total_de_rendimentos, color=ano)) +
  geom_boxplot() +
  theme_minimal() +
  scale_y_log10(labels = scales::comma, breaks=c(1050, 3000, 5000, 10000, 20000, 30000, 50000, 80000, 150000, 300000, 500000, 750000, 1500000, 6000000)) +
  theme(legend.position = "none", text = element_text(size=12)) +
  labs(y = "Valor Remuneração", x = "Ano", title = "Distribuições do valor de Remuneração") +
  theme(text= element_text(size=16))

```


```{r}

cargos_normalizados <- dados_juntos %>% 
  mutate( cargo_normalizado =
    case_when(
      str_detect(str_to_lower(cargo), "desembargador") ~ "Desembargador",
      str_detect(str_to_lower(cargo), "des") ~ "Desembargador",
      str_detect(str_to_lower(cargo), "juiz") ~ "Juiz", 
      str_detect(str_to_lower(cargo), "pensionista") ~ "Pensionista",
         str_detect(str_to_lower(cargo), "aposentado") ~ "Pensionista",
      TRUE ~"Outros"
    )
  )

total_funcionarios <- cargos_normalizados %>% nrow()

total_juiz = cargos_normalizados %>% filter(cargo_normalizado == "Juiz") %>% nrow()
total_desembagador = cargos_normalizados %>% filter(cargo_normalizado == "Desembargador") %>% nrow()
total_pensionista = cargos_normalizados %>% filter(cargo_normalizado == "Pensionista") %>% nrow()
total_outros = cargos_normalizados %>% filter(cargo_normalizado == "Outros") %>% nrow()

# Create test data.
data <- data.frame(
  category=c("Juiz", "Desembargador", "Pensionista", "Outros"),
  count=c(total_juiz/total_funcionarios * 100, total_desembagador/total_funcionarios * 100, total_pensionista/total_funcionarios * 100, total_outros/total_funcionarios * 100)
)

data %>% 
  ggplot(aes(x=category,y=count, fill=category)) + 
  geom_bar(stat="identity") + 
  labs(x="Cargo", y = "Quantidade(%)", title = "Distribuição de cargos", fill="Cargo") 
 

```
```{r}
plot_cargos_boxplot <- cargos_normalizados %>% group_by(cargo_normalizado, mes, ano) %>% summarise(total = n())

plot_cargos_boxplot %>%
  ggplot(aes(x=cargo_normalizado, y=total, color=cargo_normalizado)) +
  geom_boxplot() +
  theme_minimal() +
  scale_y_continuous(breaks=c(1000,2000,3000,5000,7000,10000,13000,15000)) +
  theme(, text = element_text(size=12)) +
  labs(y = "Quantidade de funcionários", x = "Tipo de Cargo", title = "Distribuição da quantidade para cada tipo de cargo", color="Tipo de cargo") + 
  theme(text= element_text(size=16))
```
```{r}
dados_juntos %>%  drop_na(genero) %>% filter(genero == "Male") %>% summary()
```
```{r}
dados_juntos %>%  drop_na(genero) %>% filter(genero == "Female") %>% summary()
```

%>% 

```{r}

n_male_2016 = dados_2016 %>% filter(genero == "Male") %>% nrow()
n_female_2016 = dados_2016 %>% filter(genero == "Female") %>% nrow()

n_male_2017 = dados_2017 %>% filter(genero == "Male") %>% nrow()
n_female_2017 = dados_2017 %>% filter(genero == "Female") %>% nrow()

n_male_2018 = dados_2018 %>% filter(genero == "Male") %>% nrow()
n_female_2018 = dados_2018 %>% filter(genero == "Female") %>% nrow()

n_male_2019 = dados_2019 %>% filter(genero == "Male") %>% nrow()
n_female_2019 = dados_2019 %>% filter(genero == "Female") %>% nrow()

data <- data.frame(
  category=c("Mulher", "Homem", "Mulher", "Homem", "Mulher", "Homem","Mulher", "Homem"),
  count=c(n_female_2016, n_male_2016, n_female_2017, n_male_2017, n_female_2018, n_male_2018, n_female_2019, n_male_2019),
  ano= c(2016,2016,2017,2017,2018,2018,2019,2019)
)
 

data  %>%  
  ggplot(aes(x=ano, y=count, fill=category)) +
  geom_bar(stat="identity", color="black", position=position_dodge())+
  theme_minimal() +
   labs(x="Ano", y = "Quantidade", title = "Distribuição de gênero", fill="Gênero")

data  %>%  
  ggplot(aes(x=" ", y=count, fill=category)) +
  geom_bar(stat="identity", position=position_dodge())+
  theme_minimal() +
  facet_wrap(~ano) + 
  labs(x="Ano", y = "Quantidade", title = "Distribuição de gênero", fill="Gênero")

```
```{r}
quantidade_mediana_genero <-  dados_juntos %>% drop_na(genero) %>%  group_by(genero, mes, ano) %>% summarise(total = n())

quantidade_mediana_genero2 <- quantidade_mediana_genero %>% group_by(ano, genero) %>%  summarise(mediano =  median(total))

quantidade_mediana_genero2 <- quantidade_mediana_genero2 %>%  mutate(genero_pt = ifelse(genero == "Male", "Homem", "Mulher"))

quantidade_mediana_genero2  %>%  
  ggplot(aes(x=ano, y=mediano, fill=genero_pt)) +
  geom_bar(stat="identity", color="black", position=position_dodge())+
  theme_minimal() +
   labs(x="Ano", y = "Quantidade", title = "Distribuição de gênero", fill="Gênero")

```
```{r}
totais_genero_mes_ano <- dados_juntos %>% drop_na(genero) %>% mutate(genero_pt = ifelse(genero == "Male", "Homem", "Mulher")) %>%  group_by(genero_pt, mes, ano) %>% summarise(total = n())

totais_genero_mes_ano %>%
  ggplot(aes(x=ano, y=total, color=genero_pt)) +
  geom_boxplot() +
  theme_minimal() +
  theme(, text = element_text(size=12)) +
  labs(y = "Quantidade de funcionários", x = "Tipo de Cargo", title = "Distribuição da quantidade para cada tipo de cargo", color="Tipo de cargo") + 
  theme(text= element_text(size=16))
```
```{r}
dados_juntos %>% 
  ggplot(aes(x=ano, y=total, color=genero)) +
  geom_boxplot() +
  theme_minimal() +
  theme(text = element_text(size=16)) +
  labs(y = "Quantidade de funcionários", x = "Faixa de valor de remuneração", title = "Distribuição da quantidade para cada tipo de cargo") 
  


```
 

```{r}
# Total NA: 194,962
genero_sem_NA <- dados_juntos %>%  
  drop_na(genero) %>% mutate(genero_pt = ifelse(genero == "Male", "Homem", "Mulher"))

genero_sem_NA %>% 
  ggplot(aes(x=ano, y=subsidio, color=genero_pt)) +
  geom_boxplot() +
  theme_minimal() +
  scale_y_log10(labels = scales::comma, breaks=c(1050, 3000, 5000, 10000, 15000, 20000,25000, 35000, 50000, 65000)) +
  theme(, text = element_text(size=12)) +
  labs(y = "Valor Salário", x = "Ano", title = "Distribuições do valor salárial por gênero", color = "Gênero") +
  theme(text= element_text(size=16))
```


### Dados Brasil.io

```{r}
dados_brasil_io = read_csv(here("dados/contracheque.csv"))
```


### Planos

* Grafico de barras stacked para ver o quanto de gasta com indenização salario e outros
* Mostrar média salaria por mês do sistema de justiça x executivo x legislativo
* Ditribuição dos auxilios, quais os mais utilizados? quais os que são mais gatos?
* distribuição das remunerção e descrever alguns outiliers
* Média salarial comparada com algumas outras profissões
* Questões de genêro

