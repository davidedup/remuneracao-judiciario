---
title: "TCC: Remuneração dos sistema judiciário brasileiro"

output:
  prettydoc::html_pretty:
    theme: cayman
    css: '/home/david/Área de Trabalho/tcc/stylesheets/style.css'
    highlight: github
    df_print: paged
---


```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
library(kableExtra)
library(ggplot2)
theme_set(theme_bw())
library(genderBR)
options(scipen=999)
```

# Dados do Sistema de Justiça Brasileiro

A Lei Federal 12.527/2011, ou mais comumente conhecida como Lei de Acesso à Informação (LAI), diz que é “obrigatória a divulgação em sítios oficiais da rede mundial de computadores (internet)” dos dados de gastos públicos. Por isso, órgãos que fazem parte do sistema de justiça periodicamente disponibilizam em seus sites informações detalhada sobre seus gastos, que são disponíveis para todos. Uma parte importante desses gastos são as remunerações dos trabalhadores e trabalhadoras desses órgãos.
Os agentes públicos do sistema de justiça brasileiro recebem outras verbas, além de seus salários, para exercerem seus cargos. Dentre elas encontramos auxílio moradia, despesas com saúde, auxílio transporte, gratificações, diárias, entre outros benefícios. Dados detalhados sobre essas remunerações devem ser disponibilizados nos sites de cada órgão. 
Devido a grande quantidade de auxílios é importante ter um controle sobre esses gastos e verificar a moralidade e legitimidades do recebimento desses benefícios.

## Remunerção x salário

As remunerações¹ incluem valores que vão além do salário². Os conhecidos auxílios ou indenizações, são gastos eventuais que podem constituir as remunerações. Auxílios como alimentação, pré escolar, saúde, natalidade, moradia e ajuda de custo, são exemplos de indenizações que podem ser recebidas por funcionários dos tribunais e ministérios públicos do Brasil

* ¹Remuneração: é a soma do salário mais outras vantagens (indenizações e auxílios).

* ²Salário: valor recebido de acordo com a prestação de serviços, em decorrência do contrato de trabalho.

## Descrição dos dados

Os dados utilizados nessa análise foram conseguidos através da iniciativa do DadosJusBR, que teve início no Hackfest (2018) e até hoje desenvolve trabalhos de libertação dos dados de remuneração do sistema de justiça brasileiro.  

Abaixo temos uma descrição das principais variáveis que estão disponíveis nos dados:

* subsidio = Salário recebido pelo magistrado
* direitos_pessoais = Total recebido através de direitos pessoais       
* indenizações = Total recebido através de indenizações
* direitos_eventuais = Total recebido através de direitos eventuais
* total_descontos = Somatório de todos os descontos aplicados à remuneração do Magistrado
* rendimento_liquido = Subsídios + Adicionais - Descontos
* tottal_de_rendimentos = Total de rendimentos do Magistrado"

# Como são as remunerações dos magistrados:

### 2016
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_2016 = read_csv(here("dados/2016-12-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc")
dados_2016 <- dados_2016 %>% mutate(mes = 12) %>% mutate(ano = 2016)
dados_2016$genero <- get_gender(dados_2016$nome)
```


```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
#Distribuição dos salários
dados_2016 %>%
  ggplot(aes(x=" ", y=subsidio)) +
  geom_violin() +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  scale_y_log10(labels = scales::comma, breaks=c(5000, 10000, 15000, 20000,25000, 35000, 50000, 65000)) +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.7,position=position_jitter(0.2)) +
  stat_summary(fun.y = mean, colour = "#F25E4B", geom = "point", size = 3) +
  labs(x="", y = "Salário", title = "Distribuição dos salários recebido pelos magistrados em dezembro de 2016") 


salario_min_2016 <- dados_2016 %>%  filter(subsidio > 0) %>% pull(subsidio) %>% min()
salario_max_2016 <- dados_2016 %>%pull(subsidio) %>% max()
mediana_salarial_2016 <- dados_2016 %>%pull(subsidio) %>% median() %>% round(2)
media_salarial_2016 <- dados_2016 %>%pull(subsidio) %>% mean() %>% round(2)
```

Analisando o ano de 2016 podemos observar que o salário mais baixo recebido foi de **`r salario_min_2016`** por uma pensionista do	Tribunal de Justiça do Estado do Acre isso é equivalente a 5,75 salários mínimos. Já o salário mais alto foi de **`r salario_max_2016`** recebido por uma desembargadora federal do trabalho, esse valor é equivalente a 66,4 salários mínimos.  

A média salarial foi de **`r media_salarial_2016`** com uma mediana de **`r mediana_salarial_2016`** 

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
#Distribuição dos salários
dados_2016 %>%
  drop_na(genero) %>% 
  ggplot(aes(x=genero, y=subsidio, color=genero)) +
  geom_violin() +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  scale_y_log10(labels = scales::comma, breaks=c(5000, 10000, 15000, 20000,25000, 35000, 50000, 65000)) +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.7,position=position_jitter(0.2)) +
  stat_summary(fun.y = mean, colour = "#000000", geom = "point", size = 3) +
  labs(x="", y = "Salário", title = "Distribuição dos salários de acordo com o genêro em dezembro de 2016") 


total_homem <- dados_2016 %>% drop_na(genero) %>% filter(genero == "Male") %>% count() %>%  pull(n)
total_mulher <- dados_2016 %>% drop_na(genero) %>% filter(genero == "Female") %>% count() %>%  pull(n)
media_salarial_mulher_2016 <- dados_2016 %>% drop_na(genero) %>% filter(genero == "Female") %>% pull(subsidio) %>%  mean() %>% round(2)
media_salarial_homem_2016 <- dados_2016 %>% drop_na(genero) %>% filter(genero == "Male") %>% pull(subsidio)  %>% mean() %>% round(2)

```

O total de funcionárias é de **`r total_mulher`**, enquanto o de funcionários é de **`r total_homem`**. Existem o dobro de funcionários do que de funcionárias no sistema de justiça brasileiro em dezembro de 2016. A média salárial para as mulheres é de **`r media_salarial_mulher_2016`** e para os homems é de **`r media_salarial_homem_2016`**.  

### Remuneração de acordo com cargo
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
library(stringr)
cargos_normalizados <- dados_2016 %>% 
  mutate( cargo_nomarlizado =
    case_when(
      str_detect(str_to_lower(cargo), "desembargador") ~ "Desembargador",
      str_detect(str_to_lower(cargo), "juiz") ~ "Juiz", 
      str_detect(str_to_lower(cargo), "pensionista") ~ "Pensionista",
      TRUE ~"Outros"
    )
  )
```

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
total_juiz = cargos_normalizados %>% filter(cargo_nomarlizado == "Juiz") %>% nrow()
total_desembagador = cargos_normalizados %>% filter(cargo_nomarlizado == "Desembargador") %>% nrow()
total_pensionista = cargos_normalizados %>% filter(cargo_nomarlizado == "Pensionista") %>% nrow()

# Create test data.
data <- data.frame(
  category=c("Juiz", "Desembargador", "Pensionista"),
  count=c(total_juiz, total_desembagador, total_pensionista)
)
 
# Compute percentages
data$fraction <- (data$count / sum(data$count)) * 100
# Compute the cumulative percentages (top of each rectangle)
data$ymax <- cumsum(data$fraction)
# Compute the bottom of each rectangle
data$ymin <- c(0, head(data$ymax, n=-1))
# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2
# Compute a good label
data$label <- paste0(data$category, "\n", round(data$fraction, digits = 0), "%")
# Make the plot
ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=category)) +
  geom_rect() +
  geom_text(x=3.5, aes(y=labelPosition, label=label, color=category), color = "white", size=3.2) + # x here controls label position (inner / outer)
  scale_fill_brewer(palette = "Set2") + theme_minimal() +
  scale_color_brewer(palette = "Set2") +
  coord_polar(theta="y") +
  xlim(c(1.8, 4)) +
  theme_void() + 
  labs(fill = "Cargo", title="Juizes são 80% dos funcionários em 2016") +
  theme(legend.position = "none")
```




```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
cargos_normalizados %>%
  ggplot(aes(x=cargo_nomarlizado, y=total_de__rendimentos, color=cargo_nomarlizado )) +
  geom_violin() +
  theme_minimal() + 
  scale_y_log10(labels = scales::comma, breaks=c(5000, 10000, 20000, 35000, 50000, 80000, 150000, 250000)) + 
  scale_color_brewer(palette = "Set2") +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.5,position=position_jitter(0.2)) + labs(x="",color= "Tipo  de funcionário", y = "Remuneração",       title = "Distribuição das remunerações de acordo com o cargo em 2016") 
```




```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
media_remuneracao_2016_desembargador <- cargos_normalizados %>% 
  filter(cargo_nomarlizado == "Desembargador")  %>% 
  pull(total_de__rendimentos) %>% mean() %>% round(2)

media_remuneracao_2016_juiz <- cargos_normalizados %>% 
  filter(cargo_nomarlizado == "Juiz")  %>% 
  pull(total_de__rendimentos) %>% mean() %>% round(2)

media_remuneracao_2016_pensionista <- cargos_normalizados %>% 
  filter(cargo_nomarlizado == "Pensionista")  %>% 
  pull(total_de__rendimentos) %>% mean() %>% round(2)
```
A média de remunerção de acordo com cada cargo tem a seguinte distribuição: 

- A média de remuneração de um juiz em 2016 foi de:  **`r media_remuneracao_2016_juiz`**
- A média de remuneração de um desembargador em 2016 foi de:  **`r media_remuneracao_2016_desembargador`**
- A média de remuneração de um pensionitsa em 2016 foi de:  **`r media_remuneracao_2016_pensionista`**

### 30% dos valores gastos com remuneração são com benefícios
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
# Stacked barchart
stacked_bar_chart <- dados_2016 %>%
  mutate(`Salário` = subsidio, `Beneficios` = total_de__rendimentos - subsidio) %>% 
  gather(key="type", value ="value", `Salário`, `Beneficios`) %>% 
  select(value, type, mes) %>% 
  group_by(type, mes) %>% 
  
  summarise(sum = sum(value)) 


total_salario = stacked_bar_chart %>% filter(type == "Salário")%>% pull(sum) 
total_beneficio  = stacked_bar_chart %>% filter(type =="Beneficios") %>% pull(sum)
                                                                              
stacked_bar_chart %>% 
    ggplot(aes(fill=type, y=sum, x=as.factor(mes))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Distribuições das remunerações em 2016" ) +
    scale_y_continuous(labels = scales::comma) 
``` 
Em dezembro de 2016 o total gasto com salário foi de **`r total_salario`**. Enquanto o total gasto com benefícios foi de **`r total_beneficio`**

### Judiciário x outros trabalhadores


```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_2016 %>% 
  ggplot(aes(x = total_de__rendimentos, y = 12, color = "blabla")) +  
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  geom_point(shape = 124, size = 6, alpha=0.3) + 
  scale_y_continuous(breaks=seq(1, 11, by = 1)) + 
  scale_x_log10(labels = scales::comma) + 
  theme(legend.position = "none") + labs(x = "Valor da remuneração", y = "Mês", title = "Distribuição das remuneração em 2016") + 
  geom_point(aes(x = 15768), size = 4, color = "#111111", shape = 25) +
  annotate("text", label = "Remuneração média de 2016", x = 27775.73, y = 13, color = "#111111") +
  geom_point(aes(x = 12900), size = 4, color = "orange", shape = 25) +
  annotate("text", label = "Remuneração média Legislativo de 2016", x = 12900, y = 13.2, color = "orange") +
  geom_point(aes(x = 8100), size = 4, color = "blue", shape = 25) +
  annotate("text", label = "Remuneração média Executivo de 2016", x = 8100, y = 13.3, color = "blue") +
  geom_point(aes(x = 1045), size = 4, color = "red", shape = 25) +
  annotate("text", label = "Salário mínimo", x = 1045, y = 13.4, color = "red") +
  geom_point(aes(x = 27841), size = 4, color = "purple", shape = 25) +
  annotate("text", label = "Salário do presidente", x = 27841, y = 13.4, color = "purple")
```



### 2017

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_11_2017 = read_csv(here("dados/2017-11-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc")
dados_11_2017 <- dados_11_2017 %>% mutate(mes = 11) %>% mutate(ano = 2017)

dados_12_2017 = read_csv(here("dados/2017-11-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc")

dados_12_2017 <- dados_12_2017 %>% mutate(mes = 12) %>% mutate(ano = 2017)

dados_2017 <- bind_rows(dados_11_2017, dados_12_2017)
```

### 2018

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_1_2018 = read_csv(here("dados/2018-1-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 1) %>% mutate(ano = 2018)

dados_2_2018 = read_csv(here("dados/2018-2-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 2) %>% mutate(ano = 2018)

dados_3_2018 = read_csv(here("dados/2018-3-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 3) %>% mutate(ano = 2018)

dados_4_2018 = read_csv(here("dados/2018-4-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 4) %>% mutate(ano = 2018)

dados_5_2018 = read_csv(here("dados/2018-5-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 5) %>% mutate(ano = 2018)

dados_6_2018 = read_csv(here("dados/2018-6-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 6) %>% mutate(ano = 2018)

dados_7_2018 = read_csv(here("dados/2018-7-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 7) %>% mutate(ano = 2018)

dados_8_2018 = read_csv(here("dados/2018-8-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 8) %>% mutate(ano = 2018)

dados_9_2018 = read_csv(here("dados/2018-9-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 9) %>% mutate(ano = 2018)

dados_10_2018 = read_csv(here("dados/2018-10-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 10) %>% mutate(ano = 2018)

dados_11_2018 = read_csv(here("dados/2018-11-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 11) %>% mutate(ano = 2018)

dados_12_2018 = read_csv(here("dados/2018-12-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 12) %>% mutate(ano = 2018)


dados_2018 <- bind_rows(dados_1_2018, dados_2_2018, dados_3_2018, dados_4_2018, dados_5_2018, dados_6_2018, dados_7_2018, dados_9_2018, dados_10_2018, dados_11_2018, dados_12_2018)

#summary(dados_2018)
```

### 2019
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}

dados_1_2019 = read_csv(here("dados/2019-1-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 1) %>% mutate(ano = 2019)

dados_2_2019 = read_csv(here("dados/2019-2-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 2) %>% mutate(ano = 2019)

dados_12_2019 = read_csv(here("dados/2019-12-datapackage/data.csv"),  col_types = "ccccddddddddddddddddddddddddcdddddddddcdddc") %>% mutate(mes = 12) %>% mutate(ano = 2019)

dados_2019 <-  bind_rows(dados_1_2019, dados_2_2019, dados_12_2019)

#summary(dados_2019)
```


### Dados Brasil.io

```{r}
dados_brasil_io = read_csv(here("dados/contracheque.csv"))
```


### Planos

* Grafico de barras stacked para ver o quanto de gasta com indenização salario e outros
* Mostrar média salaria por mês do sistema de justiça x executivo x legislativo
* Ditribuição dos auxilios, quais os mais utilizados? quais os que são mais gatos?
* distribuição das remunerção e descrever alguns outiliers
* Média salarial comparada com algumas outras profissões
* Questões de genêro

